<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>The Three.JS Cookbook: Shaders - NdotV</title>
  <link rel="apple-touch-icon" sizes="180x180" href="../../images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon/favicon-16x16.png">
  <link rel="manifest" href="../../site.webmanifest">
  <style>
    body{
      padding: 0;
      margin: 0;
    }
    #result{
      font-family: Arial, Helvetica, sans-serif;
      font-size: 100px;
      color: #ffffff;
      position: absolute;
      top: 50px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
    }
  </style>
</head>
<body>
  <div id="result">0</div>
<script type="importmap">
  {
    "imports": {
      "three": "../../libs/three/build/three.module.js",
      "three/addons/": "../../libs/three/examples/jsm/"
    }
  }
</script>
<script  type="module"> 
  import * as THREE from "three"
  import { OrbitControls } from "three/addons/controls/OrbitControls.js"
  import { GUI } from "three/addons/libs/lil-gui.module.min.js"

const scene = new THREE.Scene();
scene.background = new THREE.Color( 0x0000AA );

const camera = new THREE.PerspectiveCamera( 60, window.innerWidth/window.innerHeight, 0.1, 1000 );
camera.position.set( 0, 4, 6);
camera.lookAt( 0, 0, 0 );

const light = new THREE.DirectionalLight(0xffffff, 3);
light.position.set(1,1.25,1.25);
scene.add(light);

const renderer = new THREE.WebGLRenderer();
renderer.setSize( window.innerWidth, window.innerHeight );
document.body.appendChild( renderer.domElement );

const controls = new OrbitControls(camera, renderer.domElement);

let arrow1, arrow2;
createArrows();

let viewDirection = new THREE.Vector3(0, 0, 1);
let normal = new THREE.Vector3( 0, 0, 1 );
let tmp = new THREE.Vector3();

onWindowResize();
if (!('ontouchstart' in window)) window.addEventListener( 'resize', onWindowResize, false );

update();

function createArrows(){
  const points = [];
  points.push(new THREE.Vector2( 0, 0 ));
  points.push(new THREE.Vector2( 0.15, 0 ));
  points.push(new THREE.Vector2( 0.15, 1 ));
  points.push(new THREE.Vector2( 0.35, 1 ));
  points.push(new THREE.Vector2( 0, 1.8 ));
  const geometry = new THREE.LatheGeometry( points );
  geometry.rotateX( Math.PI/2 );
  const material = new THREE.MeshPhongMaterial( { color: 0xFF0000 });
  const mesh = new THREE.Mesh( geometry, material );
  scene.add( mesh );

  const mesh2 = new THREE.Mesh( geometry, material.clone() );
  mesh2.material.color.setRGB( 1, 1, 1 );
  //mesh2.position.z = 4;
  scene.add( mesh2 );
  //mesh2.rotateY( Math.PI );

  arrow1 = mesh; arrow2 = mesh2;
}

function onWindowResize( event ) {
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize( window.innerWidth, window.innerHeight );
}

function update() {
  requestAnimationFrame( update );
  arrow1.rotateY( 0.005 );
  const d = tmp.copy(normal).applyQuaternion(arrow1.quaternion).dot(viewDirection);
  const result = document.getElementById('result');
  result.innerHTML = d.toFixed(2);
  renderer.render( scene, camera );
}
</script>

</body>
</html>