<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Three.JS: Geometry - Extrude</title>
  <link rel="apple-touch-icon" sizes="180x180" href="../../images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon/favicon-16x16.png">
  <link rel="manifest" href="../../site.webmanifest">
  <style>
    body{
      padding: 0;
      margin: 0;
    }
  </style>
</head>
<body>
<script type="importmap">
  {
    "imports": {
      "three": "../../libs/three140/build/three.module.js"
    }
  }
</script>
<script  type="module"> 
  import * as THREE from "three"
  import { OrbitControls } from "../../libs/three140/examples/jsm/controls/OrbitControls.js"
  import { GLTFLoader } from "../../libs/three140/examples/jsm/loaders/GLTFLoader.js"
  import { DRACOLoader } from "../../libs/three140/examples/jsm/loaders/DRACOLoader.js"
  import { RGBELoader } from "../../libs/three140/examples/jsm/controls/RGBELoader.js"
  import { GUI } from "../../libs/three140/examples/jsm/libs/lil-gui.module.min.js"
 
  let scene, camera, renderer, clock, params, light;

  init();

  function init(){
  const assetPath = "../../assets/";
  
  scene = new THREE.Scene();
  	
  camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.1, 1000 );
  camera.position.set(0, 1, 5);//wide position
  camera.lookAt(0,0,0);
   
  renderer = new THREE.WebGLRenderer({antialias: true});
  renderer.setSize( window.innerWidth, window.innerHeight );
  document.body.appendChild( renderer.domElement );
  
  const controls = new OrbitControls(camera, renderer.domElement);
  
  const ambient = new THREE.HemisphereLight(0xffffff, 0xaaaa66, 0.1);
  scene.add(ambient);
  
  //Add lights here
  
  light = new THREE.DirectionalLight();
  light.visible = false;
  light.position.set(1,5,1);
  scene.add(light);
  
  const params = {
    environment: "none",
    background: "none",
    light: false
  }
  
  const hdrs = ['apartment', 'factory', 'field_sky', 'living_room', 'venice_sunset_1k']
  const gui = new GUI();
  gui.add(params.environment, 'environment', hdrs).onChange( value => { setEnvironment(value); });
  gui.add(params.background, 'background', hdrs).onChange( value => { setBackground(value); });
  gui.add(params.environment, 'light').onChange( value => { light.visible = value; } );

  window.addEventListener( 'resize', resize, false);
  
  update();
}

function loadModel(name){
    const loader = new GLTFLoader().setPath('../../assets/');

    const dracoLoader = new DRACOLoader();
    dracoLoader.setDecoderPath( '../../libs/three140/examples/js/libs/draco/' );
    loader.setDRACOLoader( dracoLoader );

    loader.load(
        `${name}.glb`,
        gltf => { scene.add( gltf.scene ); },
        xhr => { console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );},
        err => { console.log( `An error happened ${err.message}` ) }
    );
}

function  setBackground(name){
    const loader = new RGBELoader();
    const pmremGenerator = new THREE.PMREMGenerator( renderer );
    pmremGenerator.compileEquirectangularShader();
    
    loader.setPath('../../assets/hdr/').load( `${name}.hdr`, ( texture ) => {
        const envMap = pmremGenerator.fromEquirectangular( texture ).texture;
        pmremGenerator.dispose();

        scene.background = envMap;

    }, undefined, (err)=>{
        console.error( `An error occurred setting the background ${err.message}`);
    } );
}

function  setEnvironment(name){
    const loader = new RGBELoader();
    const pmremGenerator = new THREE.PMREMGenerator( renderer );
    pmremGenerator.compileEquirectangularShader();
    
    loader.setPath('../../assets/hdr/').load( `${name}.hdr`, ( texture ) => {
        const envMap = pmremGenerator.fromEquirectangular( texture ).texture;
        pmremGenerator.dispose();

        scene.environment = envMap;

    }, undefined, (err)=>{
        console.error( `An error occurred setting the environment ${err.message}`);
    } );
}

function update(){
  requestAnimationFrame( update );
  renderer.render( scene, camera );   
}

function resize(){
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize( window.innerWidth, window.innerHeight );
}

</script>

</body>
</html>